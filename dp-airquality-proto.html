<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: xwMOOC 데이터 제품</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">xwMOOC 데이터 제품</h1></a>
          <h2 class="subtitle">공기 품질 예측서비스 - Prototype</h2>
          <h1 id="airquality-product">1. 공기품질 예측 시스템</h1>
<p>공기품질 예측 시스템을 한땀 한땀 정성스럽게 수작업으로 개발해 보자. 목적은 공짜로 여겨졌던 공기의 품질이 너무 낮아져서 삶의 질에까지 영향을 심하게 미치기 되기 때문이다.</p>
<p>DIY 방식으로 공기품질 예측 서비스를 시작해보자. 이를 위해서 간단한 작업흐름을 다음과 같이 생성할 수 있고, 각 모듈별 필요한 기능을 구현하여 연결시켜 서비스로 제공한다.</p>
<ol type="1">
<li><a href="http://data.go.kr/">공공데이터 포털</a>을 통해 데이터를 가져온다.</li>
<li><a href="http://data.go.kr/">공공데이터 포털</a> 데이터를 탐색적으로 분석한다.</li>
<li>앞선 단계에서 탐색적 데이터 분석을 수행하여 모형과 시각화 산출물을 웹앱 형태로 개발한다.</li>
<li><a href="http://www.shinyapps.io/">shinyapps.io by RStudio</a>에 배포하여 공기품질 예측 서비스를 제공한다.</li>
</ol>
<p><img src="fig/open-data-airquality.png" alt="공공데이터 공기품질 예측" width="100%" /></p>
<h1 id="airquality-product-crawl">2. 실시간 대기 데이터 가져오기 <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h1>
<h2 id="airquality-product-crawl-key">2.1. 공공데이터 포털 인증기 발급</h2>
<p>과거 공공데이터가 파일형태로 많이 제공되었는데 최근 들어 API 형태로 데이터 제공이 늘었다. 공공데이터 특히, 대기오염정보에 대한 데이터를 받으려면 우선 본인 인증을 하고 허가를 받아야 한다. 허가가 되면 인증키가 발급된다. 이 인증키를 받아 데이터를 사람이 받아오는 대신 코드를 짜서 불러오면 된다.</p>
<p><img src="fig/airquality-api.png" alt="대기오염 API" width="100%" /></p>
<h2 id="airquality-product-crawl-document">2.2. 개발가이드</h2>
<p>상세기능정보 옆 <strong>개발가이드</strong>를 클릭하면 <code>airkorea_openapi_guide-v1_6_1.docx</code> 기술문서가 존재한다. 이를 참고하여 다음과 같은 6가지 서비스가 제공되고 이를 받으려면 개발가이드에 정의된 방식에 맞춰 요청하면 데이터를 전달받을 수 있다.</p>
<ul>
<li>시군구별 실시간 평균정보 조회</li>
<li>시도별 실시간 평균정보 조회</li>
<li>대기질 예보통보 조회</li>
<li>시도별 실시간 측정정보 조회</li>
<li>통합대기환경지수 나쁨 이상 측정소 목록조회</li>
<li>측정소별 실시간 측정정보 조회</li>
</ul>
<h2 id="airquality-product-crawl-request">2.3. 대기오염 데이터 요청</h2>
<p>“개발가이드”에서 언급된 <code>(5) 시도별 실시간 평균정보 조회</code> 27페이지의 내용을 참조하여 R 코드로 작성한다. <code>httr</code>, <code>rvest</code>, <code>glue</code> 팩키지를 동원한다. 각 팩키지가 하는 역할은 다음과 같다.</p>
<ul>
<li><code>glue</code>: RESTful API 서비스 요청을 위한 <code>url</code> 생성
<ul>
<li><code>stringr</code> 팩키지 <code>str_c()</code> 함수나, Base <code>paste()</code> 함수를 사용해도 무방하다.</li>
</ul></li>
<li><code>httr</code>: <code>GET()</code>을 통해 서비스 요청</li>
<li><code>rvest</code>: XML로 가져온 데이터를 데이터 데이터프레임으로 변환</li>
</ul>
<p><code>items</code>, <code>getXmlText()</code> 함수는 <a href="https://mrkevinna.github.io/R-Crawler-6/">Kevin Seongho Na, R Crawler 6 - Open API 데이터 수집하기</a>을 참조하였다. 자세한 설명은 원문에서 확인하면 됩니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co"># 0. 환경설정 -----</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(httr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">library</span>(rvest)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="kw">library</span>(glue)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">library</span>(DT)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co"># 1. 데이터 -----</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="co"># </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="co">## 1.1. 모수 설정 -----</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>service_url &lt;-<span class="st"> &quot;http://openapi.airkorea.or.kr/openapi/services/rest/ArpltnInforInqireSvc&quot;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>service_name &lt;-<span class="st"> &quot;getCtprvnMesureLIst&quot;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>numOfRows    &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>pageNo       &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>itemCode     &lt;-<span class="st"> &quot;PM10&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>dataGubun    &lt;-<span class="st"> &quot;DAILY&quot;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>searchCondition &lt;-<span class="st"> &quot;MONTH&quot;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>ServiceKey &lt;-<span class="st"> &quot;1LBSaBev1l3G%2FkRPTOoqig%2B0NkwcMdZ%2BY9jKNJ6LjYA3kXNnCDs0nONDaiLEq9tN2GNs6EGR0D8zsqfc4GwnEQ%3D%3D&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="co"># returnType &lt;- &quot;json&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>req_url &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;{service_url}&#39;</span>, <span class="st">&quot;/&quot;</span>, </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>                <span class="st">&#39;{service_name}&#39;</span>, <span class="st">&quot;?&quot;</span>,</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>                <span class="st">&#39;numOfRows={numOfRows}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>                <span class="st">&#39;pageNo={pageNo}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>                <span class="st">&#39;itemCode={itemCode}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>                <span class="st">&#39;dataGubun={dataGubun}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>                <span class="st">&#39;searchCondition={searchCondition}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>                <span class="st">&#39;ServiceKey={ServiceKey}&#39;</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>                <span class="dt">.sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a><span class="co">## 1.2. RESTful 서비스 테스트 -----</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>resp &lt;-<span class="st"> </span><span class="kw">GET</span>(req_url)</span></code></pre></div>
<pre class="output"><code>Backtrace:
  1. knitr::knit(&quot;dp-airquality-proto.Rmd&quot;, output = &quot;dp-airquality-proto.md&quot;)
 24. httr::GET(req_url)
 25. httr:::request_perform(req, hu$handle$handle)
 27. httr:::request_fetch.write_memory(req$output, req$url, handle)
 28. curl::curl_fetch_memory(url, handle = handle)
</code></pre>
<pre class="output"><code>Error in curl::curl_fetch_memory(url, handle = handle): Operation was aborted by an application callback
</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co">## 1.3. 데이터프레임 변환 -----</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co"># 반복되는 부분을 items 객체에 할당합니다. </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>items &lt;-<span class="st"> </span>resp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_xml</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_nodes</span>(<span class="st">&#39;item&#39;</span>)</span></code></pre></div>
<pre class="output"><code>Error in read_xml(.): could not find function &quot;read_xml&quot;
</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co"># 필요 항목만 추출하는 사용자 정의 함수를 생성합니다. </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>getXmlText &lt;-<span class="st"> </span><span class="cf">function</span>(x, var) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  result &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_node</span>(var) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_text</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  <span class="kw">return</span>(result)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>}</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="co"># 데이터프레임 변환 -----</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>aq_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>  시간 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;dataTime&#39;</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>  항목 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;itemCode&#39;</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>  서울 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;seoul&#39;</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>  부산 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;busan&#39;</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>  대구 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;daegu&#39;</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>  인천 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;incheon&#39;</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>  광주 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gwangju&#39;</span>),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>  대전 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;daejeon&#39;</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>  울산 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;ulsan&#39;</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>  경기 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeonggi&#39;</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>  강원 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gangwon&#39;</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>  충북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;chungbuk&#39;</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>  충남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;chungnam&#39;</span>),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>  전북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeonbuk&#39;</span>),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a>  전남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeonnam&#39;</span>),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>  경북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeongbuk&#39;</span>),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>  경남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeongnam&#39;</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a>  제주 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeju&#39;</span>),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a>  세종 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;sejong&#39;</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a>)</span></code></pre></div>
<pre class="output"><code>Error in xml_text(.): could not find function &quot;xml_text&quot;
</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">## 1.4. 데이터프레임 저장 -----</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="co"># aq_df %&gt;% write_rds(&quot;data/aq_df.rds&quot;)</span></span></code></pre></div>
<h2 id="airquality-product-crawl-request-check">2.4. 데이터 확인</h2>
<p>API를 통해 전달받은 데이터를 <code>aq_df</code> 데이터프레임으로 변환해서 살펴보자.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>DT<span class="op">::</span><span class="kw">datatable</span>(aq_df)</span></code></pre></div>
<pre class="output"><code>Error in crosstalk::is.SharedData(data): object &#39;aq_df&#39; not found
</code></pre>
<h1 id="airquality-product-crawl-request-many">3. 다양한 오염데이터 가져오기</h1>
<p><code>itmeCode</code> 측정항목을 구분하여 SO2, CO, O3, NO2, PM10, PM25, 총 6개 오염지표를 가져올 수 있다. 오염지표를 바꾸면 해당 오염지표 데이터를 긁어올 수 있도록 함수를 작성한다. 함수명은 <code>download_aq_data()</code>으로 하고 <code>itemCode</code>에 인자를 넘겨 데이터를 가져온다. <code>glue()</code> 함수가 요긴한데 이를 통해 요청한 데이터에 대한 상태를 즉각 확인할 수 있다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>download_aq_data &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">aq_metric=</span><span class="st">&quot;PM10&quot;</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>  service_url &lt;-<span class="st"> &quot;http://openapi.airkorea.or.kr/openapi/services/rest/ArpltnInforInqireSvc&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  service_name &lt;-<span class="st"> &quot;getCtprvnMesureLIst&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>  numOfRows    &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>  pageNo       &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>  itemCode     &lt;-<span class="st"> </span>aq_metric</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>  dataGubun    &lt;-<span class="st"> &quot;DAILY&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>  searchCondition &lt;-<span class="st"> &quot;MONTH&quot;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>  ServiceKey &lt;-<span class="st"> &quot;1LBSaBev1l3G%2FkRPTOoqig%2B0NkwcMdZ%2BY9jKNJ6LjYA3kXNnCDs0nONDaiLEq9tN2GNs6EGR0D8zsqfc4GwnEQ%3D%3D&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>  <span class="co"># returnType &lt;- &quot;json&quot;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>  req_url &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;{service_url}&#39;</span>, <span class="st">&quot;/&quot;</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>                  <span class="st">&#39;{service_name}&#39;</span>, <span class="st">&quot;?&quot;</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>                  <span class="st">&#39;numOfRows={numOfRows}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>                  <span class="st">&#39;pageNo={pageNo}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>                  <span class="st">&#39;itemCode={itemCode}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>                  <span class="st">&#39;dataGubun={dataGubun}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>                  <span class="st">&#39;searchCondition={searchCondition}&#39;</span>, <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>                  <span class="st">&#39;ServiceKey={ServiceKey}&#39;</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>                  <span class="dt">.sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a>  </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a>  <span class="co">## 1.2. RESTful 서비스 테스트 -----</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a>  resp &lt;-<span class="st"> </span><span class="kw">GET</span>(req_url)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a>  <span class="co">## 1.3. 데이터프레임 변환 -----</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true"></a>  <span class="co"># 반복되는 부분을 items 객체에 할당합니다. </span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true"></a>  items &lt;-<span class="st"> </span>resp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_xml</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_nodes</span>(<span class="st">&#39;item&#39;</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true"></a>  </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true"></a>  <span class="co"># 필요 항목만 추출하는 사용자 정의 함수를 생성합니다. </span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true"></a>  getXmlText &lt;-<span class="st"> </span><span class="cf">function</span>(x, var) {</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true"></a>    result &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_node</span>(var) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xml_text</span>()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true"></a>    <span class="kw">return</span>(result)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true"></a>  }</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true"></a>  </span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true"></a>  <span class="co"># 데이터프레임 변환 -----</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true"></a>  </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true"></a>  aq_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true"></a>    시간 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;dataTime&#39;</span>),</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true"></a>    항목 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;itemCode&#39;</span>),</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true"></a>    서울 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;seoul&#39;</span>),</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true"></a>    부산 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;busan&#39;</span>),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true"></a>    대구 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;daegu&#39;</span>),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true"></a>    인천 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;incheon&#39;</span>),</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true"></a>    광주 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gwangju&#39;</span>),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true"></a>    대전 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;daejeon&#39;</span>),</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true"></a>    울산 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;ulsan&#39;</span>),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true"></a>    경기 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeonggi&#39;</span>),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true"></a>    강원 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gangwon&#39;</span>),</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true"></a>    충북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;chungbuk&#39;</span>),</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true"></a>    충남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;chungnam&#39;</span>),</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true"></a>    전북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeonbuk&#39;</span>),</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true"></a>    전남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeonnam&#39;</span>),</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true"></a>    경북 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeongbuk&#39;</span>),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true"></a>    경남 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;gyeongnam&#39;</span>),</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true"></a>    제주 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;jeju&#39;</span>),</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true"></a>    세종 =<span class="st"> </span><span class="kw">getXmlText</span>(items, <span class="st">&#39;sejong&#39;</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true"></a>  )</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true"></a>  </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true"></a>  <span class="co">## 1.4. 데이터프레임 저장 -----</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true"></a>  </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true"></a>  aq_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">write_rds</span>(<span class="kw">paste0</span>(<span class="st">&quot;data/aq_&quot;</span>, aq_metric, <span class="st">&quot;_df.rds&quot;</span>))</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true"></a>  </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true"></a>  request_msg &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&#39;요청상태: &#39;</span>, <span class="st">&#39;{status_code(resp)}&#39;</span>,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true"></a>                      <span class="st">&#39;행수: &#39;</span>, <span class="st">&#39;{nrow(aq_df)}&#39;</span>)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true"></a>  </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true"></a>  <span class="kw">return</span>(request_msg)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true"></a>}</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true"></a><span class="kw">download_aq_data</span>(<span class="st">&quot;PM10&quot;</span>)</span></code></pre></div>
<pre class="output"><code>Error in curl::curl_fetch_memory(url, handle = handle): Timeout was reached: [openapi.airkorea.or.kr] Connection timed out after 10007 milliseconds
</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">download_aq_data</span>(<span class="st">&quot;PM25&quot;</span>)</span></code></pre></div>
<pre class="output"><code>Error in curl::curl_fetch_memory(url, handle = handle): Timeout was reached: [openapi.airkorea.or.kr] Connection timed out after 10007 milliseconds
</code></pre>
<h1 id="airquality-product-crawl-request-EDA">4. 탐색적 데이터 분석</h1>
<p>PM10에 대한 오염지표 데이터를 받아와서 <code>data/aq_PM10_df.rds</code>로 저장했다. 이를 <code>read_rds()</code>로 불러와서 <code>ggplot</code>으로 시각화하고 각 시도별로 PM10 오염도를 표로 나타낸다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co"># 1. 데이터 가져오기 -----</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>aq_pm10_df &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;data/aq_PM10_df.rds&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="co"># 2. 탐색적 데이터 분석: PM10 -----</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="co">## 2.1. 그래프 -----</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>aq_pm10_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>항목) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">gather</span>(시도, PM10, <span class="op">-</span>시간, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(시간 =<span class="st"> </span><span class="kw">ymd</span>(시간),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>         <span class="dt">PM10 =</span> <span class="kw">as.integer</span>(PM10)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>시간, <span class="dt">y=</span>PM10, <span class="dt">group=</span>시도, <span class="dt">color=</span>시도)) <span class="op">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a><span class="st">    </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%m-%d&quot;</span>) <span class="op">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="fig/airquality-EDA-1.png" title="plot of chunk airquality-EDA" alt="plot of chunk airquality-EDA" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="co">## 2.2. 표 -----</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>aq_pm10_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">datatable</span>()</span></code></pre></div>
<p><img src="fig/airquality-EDA-2.png" title="plot of chunk airquality-EDA" alt="plot of chunk airquality-EDA" style="display: block; margin: auto;" /></p>
<h1 id="airquality-product-crawl-request-EDA-shiny">5. Shiny 웹앱 개발</h1>
<p>실시간 대기오염정보 예측을 위해서 <code>shiny</code> 웹앱으로 구현이 필요하다. 이를 위해서 앞서 전달받은 데이터를 일단 파일형태로 저장하고 저장된 파일을 “PM10”, “PM25” 형태에 맞춰 그래프와 표로 나타내는 웹앱을 구현해본다.</p>
<p><img src="fig/airquality-shiny-wireframe.png" alt="Shiny 웹앱 와이어프레임" width="77%" /></p>
<h2 id="airquality-product-crawl-request-EDA-shiny-global">5.1. <code>global.R</code></h2>
<p>대기오염정보 API를 다운로드 받은 데이터를 <code>.rds</code> 파일로 저장한 후에 이를 <code>global.R</code>에서 “PM10”은 <code>aq_pm10_df</code>, “PM2.5”는 <code>aq_pm25_df</code>로 불러와서 웹앱에서 데이터로 사용한다.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="co"># 0. 환경설정 -----</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="kw">library</span>(httr)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a><span class="kw">library</span>(rvest)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a><span class="kw">library</span>(glue)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a><span class="kw">library</span>(ggthemes)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a><span class="kw">library</span>(DT)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a><span class="kw">library</span>(shiny)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a><span class="co"># 1. 데이터 -----</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>aq_pm10_df &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;data/aq_PM10_df.rds&quot;</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>aq_pm25_df &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;data/aq_PM25_df.rds&quot;</span>)</span></code></pre></div>
<h2 id="airquality-product-crawl-request-EDA-shiny-ui-server">5.2. <code>ui.R</code>, <code>server.R</code></h2>
<p><code>selectInput()</code> 함수로 “PM2.5”, “PM10” 에 따라 탐색적 데이터분석에서 나온 결과를 뿌려줄 수 있도록 UI를 작성하고 <code>server.R</code>에서 불러 사용할 수 있도록 조치를 취한다.</p>
<div class="row">
<div class="col-md-6">
<p><strong>ur.R</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">library</span>(shiny)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="kw">shinyUI</span>(<span class="kw">fluidPage</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>  </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Air Quality - PM10&quot;</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>  </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>      <span class="kw">selectInput</span>(<span class="st">&#39;aq_metric&#39;</span>, <span class="st">&#39;Air Quality Metric&#39;</span>, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;PM10&quot;</span>=<span class="st">&quot;pm10&quot;</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>                                                                 <span class="st">&quot;PM25&quot;</span>=<span class="st">&quot;pm25&quot;</span>), <span class="dt">selected =</span> <span class="st">&quot;pm10&quot;</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>  ),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>  </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a>    <span class="co"># Show a plot of the generated distribution</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true"></a>      <span class="kw">h2</span>(<span class="st">&quot;PM10 Metrics by Province&quot;</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true"></a>      </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true"></a>      <span class="kw">conditionalPanel</span>(<span class="dt">condition =</span> <span class="st">&quot;input.aq_metric == &#39;pm10&#39;&quot;</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true"></a>         <span class="kw">h3</span>(<span class="st">&quot;PM10 Trend&quot;</span>),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true"></a>         <span class="kw">plotOutput</span>(<span class="st">&quot;pm10_plot&quot;</span>),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true"></a>         <span class="kw">h3</span>(<span class="st">&quot;PM10 Table&quot;</span>),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true"></a>         DT<span class="op">::</span><span class="kw">dataTableOutput</span>(<span class="st">&quot;pm10_table&quot;</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true"></a>      ),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true"></a>      <span class="kw">conditionalPanel</span>(<span class="dt">condition =</span> <span class="st">&quot;input.aq_metric == &#39;pm25&#39;&quot;</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true"></a>         <span class="kw">h3</span>(<span class="st">&quot;PM25 Trend&quot;</span>),</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true"></a>         <span class="kw">plotOutput</span>(<span class="st">&quot;pm25_plot&quot;</span>),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true"></a>         <span class="kw">h3</span>(<span class="st">&quot;PM25 Table&quot;</span>),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true"></a>         DT<span class="op">::</span><span class="kw">dataTableOutput</span>(<span class="st">&quot;pm25_table&quot;</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true"></a>      )</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true"></a>  )</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true"></a>)))</span></code></pre></div>
</div>
<div class="col-md-6">
<p><strong>server.R</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">shinyServer</span>(<span class="cf">function</span>(input, output) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="co"># PM10 -----   </span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>  output<span class="op">$</span>pm10_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>    aq_pm10_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>항목) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a><span class="st">      </span><span class="kw">gather</span>(시도, PM10, <span class="op">-</span>시간, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="st">      </span><span class="kw">mutate</span>(시간 =<span class="st"> </span><span class="kw">ymd</span>(시간),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>               <span class="dt">PM10 =</span> <span class="kw">as.integer</span>(PM10)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>시간, <span class="dt">y=</span>PM10, <span class="dt">group=</span>시도, <span class="dt">color=</span>시도)) <span class="op">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a><span class="st">      </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a><span class="st">      </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a><span class="st">      </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%m-%d&quot;</span>) <span class="op">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true"></a><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true"></a><span class="st">      </span><span class="kw">theme_minimal</span>()</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true"></a>  })</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true"></a>  </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true"></a>  output<span class="op">$</span>pm10_table =<span class="st"> </span>DT<span class="op">::</span><span class="kw">renderDataTable</span>({</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true"></a>    </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true"></a>    aq_pm10_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true"></a><span class="st">      </span><span class="kw">datatable</span>()</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true"></a>  })</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true"></a><span class="co"># PM25 -----   </span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true"></a>  output<span class="op">$</span>pm25_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true"></a>    aq_pm25_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true"></a><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>항목) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true"></a><span class="st">      </span><span class="kw">gather</span>(시도, PM25, <span class="op">-</span>시간, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true"></a><span class="st">      </span><span class="kw">mutate</span>(시간 =<span class="st"> </span><span class="kw">ymd</span>(시간),</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true"></a>             <span class="dt">PM25 =</span> <span class="kw">as.integer</span>(PM25)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true"></a><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>시간, <span class="dt">y=</span>PM25, <span class="dt">group=</span>시도, <span class="dt">color=</span>시도)) <span class="op">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true"></a><span class="st">      </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true"></a><span class="st">      </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true"></a><span class="st">      </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%m-%d&quot;</span>) <span class="op">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true"></a><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true"></a><span class="st">      </span><span class="kw">theme_minimal</span>()</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true"></a>  })</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true"></a>  </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true"></a>  output<span class="op">$</span>pm25_table =<span class="st"> </span>DT<span class="op">::</span><span class="kw">renderDataTable</span>({</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true"></a>    </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true"></a>    aq_pm25_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true"></a><span class="st">      </span><span class="kw">datatable</span>()</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true"></a>  })</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true"></a>  </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true"></a>})</span></code></pre></div>
</div>
</div>
<p><img src="fig/airquality-basic-shiny.png" alt="Shiny 웹앱 기본기능" width="77%" /></p>
<h1 id="airquality-product-crawl-request-EDA-shinyappsio">6. <code>shinyapps.io</code> 배포</h1>
<p>RStudio에서 <strong>publish</strong> 버튼을 클릭하여 <a href="https://www.shinyapps.io/">shinyapps.io</a>에 배포한다. 한글관련 깨지는 문제가 있으나 이는 추후 수정한다.</p>
<p><img src="fig/airquality-basic-shinyapps.png" alt="Shiny 웹앱 배포" width="77%" /></p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://mrkevinna.github.io/R-Crawler-6/">Kevin Seongho Na, R Crawler 6 - Open API 데이터 수집하기</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
